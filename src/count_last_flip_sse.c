/**
 * @file count_last_flip_sse.c
 *
 *
 * A function is provided to count the number of fipped disc of the last move.
 *
 * The basic principle is to read into an array a precomputed result. Doing
 * this is easy for a single line ; as we can use arrays of the form:
 *  - COUNT_FLIP[square where we play][8-bits disc pattern].
 * The problem is thus to convert any line of a 64-bits disc pattern into an
 * 8-bits disc pattern. A fast way to do this is to select the right line,
 * with a bit-mask, to gather the masked-bits into a continuous set by the 
 * SSE PMOVMSKB or PSADBW instruction.
 * Once we get our 8-bits disc patterns, we directly get the number of
 * flipped discs from the precomputed array, and add them from each flipping
 * lines.
 * For optimization purpose, the value returned is twice the number of flipped
 * disc, to facilitate the computation of disc difference.
 *
 * @date 1998 - 2025
 * @author Richard Delorme
 * @author Toshihiko Okuhara
 * @version 4.5
 * 
 */

#include "bit.h"
#include <stdint.h>

/** precomputed count flip array */
/** lower byte for P, upper byte for O */
static const uint16_t COUNT_FLIP[] = {
	// CF80: 0
	0x0000, 0x0000, 0x0200, 0x0200, 0x0002, 0x0002, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0200, 0x0200, 0x0002, 0x0002, 0x0600, 0x0600,
	0x0006, 0x0006, 0x0200, 0x0200, 0x0002, 0x0002, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0200, 0x0200, 0x0002, 0x0002, 0x0800, 0x0800,
	0x0008, 0x0008, 0x0200, 0x0200, 0x0002, 0x0002, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0200, 0x0200, 0x0002, 0x0002, 0x0600, 0x0600,
	0x0006, 0x0006, 0x0200, 0x0200, 0x0002, 0x0002, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0200, 0x0200, 0x0002, 0x0002, 0x0a00, 0x0a00,
	0x000a, 0x000a, 0x0200, 0x0200, 0x0002, 0x0002, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0200, 0x0200, 0x0002, 0x0002, 0x0600, 0x0600,
	0x0006, 0x0006, 0x0200, 0x0200, 0x0002, 0x0002, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0200, 0x0200, 0x0002, 0x0002, 0x0800, 0x0800,
	0x0008, 0x0008, 0x0200, 0x0200, 0x0002, 0x0002, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0200, 0x0200, 0x0002, 0x0002, 0x0600, 0x0600,
	0x0006, 0x0006, 0x0200, 0x0200, 0x0002, 0x0002, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0200, 0x0200, 0x0002, 0x0002, 0x0c00, 0x0c00,
	0x000c, 0x000c, 0x0200, 0x0200, 0x0002, 0x0002, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0200, 0x0200, 0x0002, 0x0002, 0x0600, 0x0600,
	0x0006, 0x0006, 0x0200, 0x0200, 0x0002, 0x0002, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0200, 0x0200, 0x0002, 0x0002, 0x0800, 0x0800,
	0x0008, 0x0008, 0x0200, 0x0200, 0x0002, 0x0002, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0200, 0x0200, 0x0002, 0x0002, 0x0600, 0x0600,
	0x0006, 0x0006, 0x0200, 0x0200, 0x0002, 0x0002, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0200, 0x0200, 0x0002, 0x0002, 0x0a00, 0x0a00,
	0x000a, 0x000a, 0x0200, 0x0200, 0x0002, 0x0002, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0200, 0x0200, 0x0002, 0x0002, 0x0600, 0x0600,
	0x0006, 0x0006, 0x0200, 0x0200, 0x0002, 0x0002, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0200, 0x0200, 0x0002, 0x0002, 0x0800, 0x0800,
	0x0008, 0x0008, 0x0200, 0x0200, 0x0002, 0x0002, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0200, 0x0200, 0x0002, 0x0002, 0x0600, 0x0600,
	0x0006, 0x0006, 0x0200, 0x0200, 0x0002, 0x0002, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0200, 0x0200, 0x0002, 0x0002, 0x0000, 0x0000,
	// CF81: 256
	0x0000, 0x0000, 0x0000, 0x0000, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0400, 0x0400, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0004, 0x0004, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0600, 0x0600, 0x0600, 0x0600,
	0x0006, 0x0006, 0x0006, 0x0006, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0400, 0x0400, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0004, 0x0004, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0800, 0x0800, 0x0800, 0x0800,
	0x0008, 0x0008, 0x0008, 0x0008, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0400, 0x0400, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0004, 0x0004, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0600, 0x0600, 0x0600, 0x0600,
	0x0006, 0x0006, 0x0006, 0x0006, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0400, 0x0400, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0004, 0x0004, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0a00, 0x0a00, 0x0a00, 0x0a00,
	0x000a, 0x000a, 0x000a, 0x000a, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0400, 0x0400, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0004, 0x0004, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0600, 0x0600, 0x0600, 0x0600,
	0x0006, 0x0006, 0x0006, 0x0006, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0400, 0x0400, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0004, 0x0004, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0800, 0x0800, 0x0800, 0x0800,
	0x0008, 0x0008, 0x0008, 0x0008, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0400, 0x0400, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0004, 0x0004, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0600, 0x0600, 0x0600, 0x0600,
	0x0006, 0x0006, 0x0006, 0x0006, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0400, 0x0400, 0x0400, 0x0400,
	0x0004, 0x0004, 0x0004, 0x0004, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0000, 0x0000, 0x0000, 0x0000,
	// CF82: 512
	0x0000, 0x0002, 0x0200, 0x0000, 0x0000, 0x0002, 0x0200, 0x0000,
	0x0200, 0x0202, 0x0400, 0x0200, 0x0200, 0x0202, 0x0400, 0x0200,
	0x0002, 0x0004, 0x0202, 0x0002, 0x0002, 0x0004, 0x0202, 0x0002,
	0x0400, 0x0402, 0x0600, 0x0400, 0x0400, 0x0402, 0x0600, 0x0400,
	0x0004, 0x0006, 0x0204, 0x0004, 0x0004, 0x0006, 0x0204, 0x0004,
	0x0200, 0x0202, 0x0400, 0x0200, 0x0200, 0x0202, 0x0400, 0x0200,
	0x0002, 0x0004, 0x0202, 0x0002, 0x0002, 0x0004, 0x0202, 0x0002,
	0x0600, 0x0602, 0x0800, 0x0600, 0x0600, 0x0602, 0x0800, 0x0600,
	0x0006, 0x0008, 0x0206, 0x0006, 0x0006, 0x0008, 0x0206, 0x0006,
	0x0200, 0x0202, 0x0400, 0x0200, 0x0200, 0x0202, 0x0400, 0x0200,
	0x0002, 0x0004, 0x0202, 0x0002, 0x0002, 0x0004, 0x0202, 0x0002,
	0x0400, 0x0402, 0x0600, 0x0400, 0x0400, 0x0402, 0x0600, 0x0400,
	0x0004, 0x0006, 0x0204, 0x0004, 0x0004, 0x0006, 0x0204, 0x0004,
	0x0200, 0x0202, 0x0400, 0x0200, 0x0200, 0x0202, 0x0400, 0x0200,
	0x0002, 0x0004, 0x0202, 0x0002, 0x0002, 0x0004, 0x0202, 0x0002,
	0x0800, 0x0802, 0x0a00, 0x0800, 0x0800, 0x0802, 0x0a00, 0x0800,
	0x0008, 0x000a, 0x0208, 0x0008, 0x0008, 0x000a, 0x0208, 0x0008,
	0x0200, 0x0202, 0x0400, 0x0200, 0x0200, 0x0202, 0x0400, 0x0200,
	0x0002, 0x0004, 0x0202, 0x0002, 0x0002, 0x0004, 0x0202, 0x0002,
	0x0400, 0x0402, 0x0600, 0x0400, 0x0400, 0x0402, 0x0600, 0x0400,
	0x0004, 0x0006, 0x0204, 0x0004, 0x0004, 0x0006, 0x0204, 0x0004,
	0x0200, 0x0202, 0x0400, 0x0200, 0x0200, 0x0202, 0x0400, 0x0200,
	0x0002, 0x0004, 0x0202, 0x0002, 0x0002, 0x0004, 0x0202, 0x0002,
	0x0600, 0x0602, 0x0800, 0x0600, 0x0600, 0x0602, 0x0800, 0x0600,
	0x0006, 0x0008, 0x0206, 0x0006, 0x0006, 0x0008, 0x0206, 0x0006,
	0x0200, 0x0202, 0x0400, 0x0200, 0x0200, 0x0202, 0x0400, 0x0200,
	0x0002, 0x0004, 0x0202, 0x0002, 0x0002, 0x0004, 0x0202, 0x0002,
	0x0400, 0x0402, 0x0600, 0x0400, 0x0400, 0x0402, 0x0600, 0x0400,
	0x0004, 0x0006, 0x0204, 0x0004, 0x0004, 0x0006, 0x0204, 0x0004,
	0x0200, 0x0202, 0x0400, 0x0200, 0x0200, 0x0202, 0x0400, 0x0200,
	0x0002, 0x0004, 0x0202, 0x0002, 0x0002, 0x0004, 0x0202, 0x0002,
	0x0000, 0x0002, 0x0200, 0x0000, 0x0000, 0x0002, 0x0200, 0x0000,
	// CF83: 768
	0x0000, 0x0004, 0x0002, 0x0002, 0x0200, 0x0200, 0x0400, 0x0000,
	0x0000, 0x0004, 0x0002, 0x0002, 0x0200, 0x0200, 0x0400, 0x0000,
	0x0200, 0x0204, 0x0202, 0x0202, 0x0400, 0x0400, 0x0600, 0x0200,
	0x0200, 0x0204, 0x0202, 0x0202, 0x0400, 0x0400, 0x0600, 0x0200,
	0x0002, 0x0006, 0x0004, 0x0004, 0x0202, 0x0202, 0x0402, 0x0002,
	0x0002, 0x0006, 0x0004, 0x0004, 0x0202, 0x0202, 0x0402, 0x0002,
	0x0400, 0x0404, 0x0402, 0x0402, 0x0600, 0x0600, 0x0800, 0x0400,
	0x0400, 0x0404, 0x0402, 0x0402, 0x0600, 0x0600, 0x0800, 0x0400,
	0x0004, 0x0008, 0x0006, 0x0006, 0x0204, 0x0204, 0x0404, 0x0004,
	0x0004, 0x0008, 0x0006, 0x0006, 0x0204, 0x0204, 0x0404, 0x0004,
	0x0200, 0x0204, 0x0202, 0x0202, 0x0400, 0x0400, 0x0600, 0x0200,
	0x0200, 0x0204, 0x0202, 0x0202, 0x0400, 0x0400, 0x0600, 0x0200,
	0x0002, 0x0006, 0x0004, 0x0004, 0x0202, 0x0202, 0x0402, 0x0002,
	0x0002, 0x0006, 0x0004, 0x0004, 0x0202, 0x0202, 0x0402, 0x0002,
	0x0600, 0x0604, 0x0602, 0x0602, 0x0800, 0x0800, 0x0a00, 0x0600,
	0x0600, 0x0604, 0x0602, 0x0602, 0x0800, 0x0800, 0x0a00, 0x0600,
	0x0006, 0x000a, 0x0008, 0x0008, 0x0206, 0x0206, 0x0406, 0x0006,
	0x0006, 0x000a, 0x0008, 0x0008, 0x0206, 0x0206, 0x0406, 0x0006,
	0x0200, 0x0204, 0x0202, 0x0202, 0x0400, 0x0400, 0x0600, 0x0200,
	0x0200, 0x0204, 0x0202, 0x0202, 0x0400, 0x0400, 0x0600, 0x0200,
	0x0002, 0x0006, 0x0004, 0x0004, 0x0202, 0x0202, 0x0402, 0x0002,
	0x0002, 0x0006, 0x0004, 0x0004, 0x0202, 0x0202, 0x0402, 0x0002,
	0x0400, 0x0404, 0x0402, 0x0402, 0x0600, 0x0600, 0x0800, 0x0400,
	0x0400, 0x0404, 0x0402, 0x0402, 0x0600, 0x0600, 0x0800, 0x0400,
	0x0004, 0x0008, 0x0006, 0x0006, 0x0204, 0x0204, 0x0404, 0x0004,
	0x0004, 0x0008, 0x0006, 0x0006, 0x0204, 0x0204, 0x0404, 0x0004,
	0x0200, 0x0204, 0x0202, 0x0202, 0x0400, 0x0400, 0x0600, 0x0200,
	0x0200, 0x0204, 0x0202, 0x0202, 0x0400, 0x0400, 0x0600, 0x0200,
	0x0002, 0x0006, 0x0004, 0x0004, 0x0202, 0x0202, 0x0402, 0x0002,
	0x0002, 0x0006, 0x0004, 0x0004, 0x0202, 0x0202, 0x0402, 0x0002,
	0x0000, 0x0004, 0x0002, 0x0002, 0x0200, 0x0200, 0x0400, 0x0000,
	0x0000, 0x0004, 0x0002, 0x0002, 0x0200, 0x0200, 0x0400, 0x0000,
	// CF84: 1024
	0x0000, 0x0006, 0x0004, 0x0004, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0400, 0x0400, 0x0600, 0x0000,
	0x0000, 0x0006, 0x0004, 0x0004, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0400, 0x0400, 0x0600, 0x0000,
	0x0200, 0x0206, 0x0204, 0x0204, 0x0202, 0x0202, 0x0202, 0x0202,
	0x0400, 0x0400, 0x0400, 0x0400, 0x0600, 0x0600, 0x0800, 0x0200,
	0x0200, 0x0206, 0x0204, 0x0204, 0x0202, 0x0202, 0x0202, 0x0202,
	0x0400, 0x0400, 0x0400, 0x0400, 0x0600, 0x0600, 0x0800, 0x0200,
	0x0002, 0x0008, 0x0006, 0x0006, 0x0004, 0x0004, 0x0004, 0x0004,
	0x0202, 0x0202, 0x0202, 0x0202, 0x0402, 0x0402, 0x0602, 0x0002,
	0x0002, 0x0008, 0x0006, 0x0006, 0x0004, 0x0004, 0x0004, 0x0004,
	0x0202, 0x0202, 0x0202, 0x0202, 0x0402, 0x0402, 0x0602, 0x0002,
	0x0400, 0x0406, 0x0404, 0x0404, 0x0402, 0x0402, 0x0402, 0x0402,
	0x0600, 0x0600, 0x0600, 0x0600, 0x0800, 0x0800, 0x0a00, 0x0400,
	0x0400, 0x0406, 0x0404, 0x0404, 0x0402, 0x0402, 0x0402, 0x0402,
	0x0600, 0x0600, 0x0600, 0x0600, 0x0800, 0x0800, 0x0a00, 0x0400,
	0x0004, 0x000a, 0x0008, 0x0008, 0x0006, 0x0006, 0x0006, 0x0006,
	0x0204, 0x0204, 0x0204, 0x0204, 0x0404, 0x0404, 0x0604, 0x0004,
	0x0004, 0x000a, 0x0008, 0x0008, 0x0006, 0x0006, 0x0006, 0x0006,
	0x0204, 0x0204, 0x0204, 0x0204, 0x0404, 0x0404, 0x0604, 0x0004,
	0x0200, 0x0206, 0x0204, 0x0204, 0x0202, 0x0202, 0x0202, 0x0202,
	0x0400, 0x0400, 0x0400, 0x0400, 0x0600, 0x0600, 0x0800, 0x0200,
	0x0200, 0x0206, 0x0204, 0x0204, 0x0202, 0x0202, 0x0202, 0x0202,
	0x0400, 0x0400, 0x0400, 0x0400, 0x0600, 0x0600, 0x0800, 0x0200,
	0x0002, 0x0008, 0x0006, 0x0006, 0x0004, 0x0004, 0x0004, 0x0004,
	0x0202, 0x0202, 0x0202, 0x0202, 0x0402, 0x0402, 0x0602, 0x0002,
	0x0002, 0x0008, 0x0006, 0x0006, 0x0004, 0x0004, 0x0004, 0x0004,
	0x0202, 0x0202, 0x0202, 0x0202, 0x0402, 0x0402, 0x0602, 0x0002,
	0x0000, 0x0006, 0x0004, 0x0004, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0400, 0x0400, 0x0600, 0x0000,
	0x0000, 0x0006, 0x0004, 0x0004, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0400, 0x0400, 0x0600, 0x0000,
	// CF85: 1280
	0x0000, 0x0008, 0x0006, 0x0006, 0x0004, 0x0004, 0x0004, 0x0004,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0400, 0x0400, 0x0400, 0x0400, 0x0600, 0x0600, 0x0800, 0x0000,
	0x0000, 0x0008, 0x0006, 0x0006, 0x0004, 0x0004, 0x0004, 0x0004,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0400, 0x0400, 0x0400, 0x0400, 0x0600, 0x0600, 0x0800, 0x0000,
	0x0200, 0x0208, 0x0206, 0x0206, 0x0204, 0x0204, 0x0204, 0x0204,
	0x0202, 0x0202, 0x0202, 0x0202, 0x0202, 0x0202, 0x0202, 0x0202,
	0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400,
	0x0600, 0x0600, 0x0600, 0x0600, 0x0800, 0x0800, 0x0a00, 0x0200,
	0x0200, 0x0208, 0x0206, 0x0206, 0x0204, 0x0204, 0x0204, 0x0204,
	0x0202, 0x0202, 0x0202, 0x0202, 0x0202, 0x0202, 0x0202, 0x0202,
	0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400,
	0x0600, 0x0600, 0x0600, 0x0600, 0x0800, 0x0800, 0x0a00, 0x0200,
	0x0002, 0x000a, 0x0008, 0x0008, 0x0006, 0x0006, 0x0006, 0x0006,
	0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004,
	0x0202, 0x0202, 0x0202, 0x0202, 0x0202, 0x0202, 0x0202, 0x0202,
	0x0402, 0x0402, 0x0402, 0x0402, 0x0602, 0x0602, 0x0802, 0x0002,
	0x0002, 0x000a, 0x0008, 0x0008, 0x0006, 0x0006, 0x0006, 0x0006,
	0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004,
	0x0202, 0x0202, 0x0202, 0x0202, 0x0202, 0x0202, 0x0202, 0x0202,
	0x0402, 0x0402, 0x0402, 0x0402, 0x0602, 0x0602, 0x0802, 0x0002,
	0x0000, 0x0008, 0x0006, 0x0006, 0x0004, 0x0004, 0x0004, 0x0004,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0400, 0x0400, 0x0400, 0x0400, 0x0600, 0x0600, 0x0800, 0x0000,
	0x0000, 0x0008, 0x0006, 0x0006, 0x0004, 0x0004, 0x0004, 0x0004,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0400, 0x0400, 0x0400, 0x0400, 0x0600, 0x0600, 0x0800, 0x0000,
	// CF86: 1536
	0x0000, 0x000a, 0x0008, 0x0008, 0x0006, 0x0006, 0x0006, 0x0006,
	0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400,
	0x0600, 0x0600, 0x0600, 0x0600, 0x0800, 0x0800, 0x0a00, 0x0000,
	0x0000, 0x000a, 0x0008, 0x0008, 0x0006, 0x0006, 0x0006, 0x0006,
	0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400,
	0x0600, 0x0600, 0x0600, 0x0600, 0x0800, 0x0800, 0x0a00, 0x0000,
	0x0000, 0x000a, 0x0008, 0x0008, 0x0006, 0x0006, 0x0006, 0x0006,
	0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400,
	0x0600, 0x0600, 0x0600, 0x0600, 0x0800, 0x0800, 0x0a00, 0x0000,
	0x0000, 0x000a, 0x0008, 0x0008, 0x0006, 0x0006, 0x0006, 0x0006,
	0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400,
	0x0600, 0x0600, 0x0600, 0x0600, 0x0800, 0x0800, 0x0a00, 0x0000,
	// CF87: 1792
	0x0000, 0x000c, 0x000a, 0x000a, 0x0008, 0x0008, 0x0008, 0x0008,
	0x0006, 0x0006, 0x0006, 0x0006, 0x0006, 0x0006, 0x0006, 0x0006,
	0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004,
	0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400,
	0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400,
	0x0600, 0x0600, 0x0600, 0x0600, 0x0600, 0x0600, 0x0600, 0x0600,
	0x0800, 0x0800, 0x0800, 0x0800, 0x0a00, 0x0a00, 0x0c00, 0x0000,
	0x0000, 0x000c, 0x000a, 0x000a, 0x0008, 0x0008, 0x0008, 0x0008,
	0x0006, 0x0006, 0x0006, 0x0006, 0x0006, 0x0006, 0x0006, 0x0006,
	0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004,
	0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002, 0x0002,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200,
	0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400,
	0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400, 0x0400,
	0x0600, 0x0600, 0x0600, 0x0600, 0x0600, 0x0600, 0x0600, 0x0600,
	0x0800, 0x0800, 0x0800, 0x0800, 0x0a00, 0x0a00, 0x0c00, 0x0000,

	// for shorter diagonal lines (interleaved), * = pos = 0
	// RF70: 2048 (.bbbbbb*)
	         // LF74: 2049 (bb*bbbb.)
	0x0000,  0x0000,      0x0200,  0x0006,      0x0002,  0x0004,      0x0400,  0x0004,
	0x0004,  0x0002,      0x0200,  0x0002,      0x0002,  0x0002,      0x0600,  0x0002,
	0x0006,  0x0200,      0x0200,  0x0200,      0x0002,  0x0200,      0x0400,  0x0200,
	0x0004,  0x0400,      0x0200,  0x0400,      0x0002,  0x0600,      0x0800,  0x0000,
	             // LF63: 2081 (bb*bbb..)                                          // LF41 (bb*0....)
	                                   // LF52: 2083 (bb*bb...)                    // LF30 (bb*.....)
	0x0008,      0x0000,  0x0200,      0x0000,  0x0002,      0x0004,  0x0400,      0x0000,
	0x0004,      0x0002,  0x0200,      0x0002,  0x0002,      0x0002,  0x0600,      0x0000,
	0x0006,      0x0200,  0x0200,      0x0200,  0x0002,      0x0200,  0x0400,      0x0000,
	0x0004,      0x0400,  0x0200,      0x0000,  0x0002,      0x0000,  0x0a00,      0,
	0x000a,  0x0200,      0x0200,  0x0206,      0x0002,  0x0204,      0x0400,  0x0204,
	0x0004,  0x0202,      0x0200,  0x0202,      0x0002,  0x0202,      0x0600,  0x0202,
	0x0006,  0x0400,      0x0200,  0x0400,      0x0002,  0x0400,      0x0400,  0x0400,
	0x0004,  0x0600,      0x0200,  0x0600,      0x0002,  0x0800,      0x0800,  0x0200,
	0x0008,      0x0200,  0x0200,      0x0200,  0x0002,      0x0204,  0x0400,      0x0200,
	0x0004,      0x0202,  0x0200,      0x0202,  0x0002,      0x0202,  0x0600,      0x0200,
	0x0006,      0x0400,  0x0200,      0x0400,  0x0002,      0x0400,  0x0400,      0x0200,
	0x0004,      0x0600,  0x0200,      0x0200,  0x0002,      0x0200,  0x0000,      0,
	// RF71: 2176 (.bbbbb*0)
	                      // RF61: 2178 (..bbbb*0)
	0x0000,  0x0002,      0x0000,  0x0008,      0x0200,  0x0006,      0x0200,  0x0006,
	0x0002,  0x0004,      0x0002,  0x0004,      0x0400,  0x0004,      0x0400,  0x0004,
	0x0004,  0x0202,      0x0004,  0x0202,      0x0200,  0x0202,      0x0200,  0x0202,
	0x0002,  0x0402,      0x0002,  0x0402,      0x0600,  0x0602,      0x0600,  0x0002,
	0x0006,      0x0002,  0x0006,      0x0002,  0x0200,      0x0006,  0x0200,      0x0002,
	0x0002,      0x0004,  0x0002,      0x0004,  0x0400,      0x0004,  0x0400,      0x0002,
	0x0004,      0x0202,  0x0004,      0x0202,  0x0200,      0x0202,  0x0200,      0x0002,
	0x0002,      0x0402,  0x0002,      0x0002,  0x0800,      0x0002,  0x0000,      0,
	                      // RF51: 2242 (...bbb*0)
	0x0008,  0x0000,      0x0000,  0x0006,      0x0200,  0x0004,      0x0200,  0x0004,
	0x0002,  0x0002,      0x0002,  0x0002,      0x0400,  0x0002,      0x0400,  0x0002,
	0x0004,  0x0200,      0x0004,  0x0200,      0x0200,  0x0200,      0x0200,  0x0200,
	0x0002,  0x0400,      0x0002,  0x0400,      0x0600,  0x0600,      0x0000,  0x0000,
	                      // RF41: 2274 (....bb*0)
	0x0006,      0x0000,  0x0000,      0x0000,  0x0200,      0x0004,  0x0200,      0x0000,
	0x0002,      0x0002,  0x0002,      0x0002,  0x0400,      0x0002,  0x0000,      0x0000,
	                      // RF31 (.....0*0)
	0x0004,      0x0200,  0x0000,      0x0200,  0x0200,      0x0200,  0x0000,      0x0000,
	0x0002,      0x0400,  0,           0x0000,  0x0000,      0x0000,  0,           0,

	// RF60: 2304 (..bbbbb*)
	         // RF50: 2305 (...bbbb*)
	0x0000,  0x0000,  0x0200,  0x0200,  0x0002,  0x0002,  0x0400,  0x0400,
	0x0004,  0x0004,  0x0200,  0x0200,  0x0002,  0x0002,  0x0600,  0x0600,
	0x0006,  0x0006,  0x0200,  0x0200,  0x0002,  0x0002,  0x0400,  0x0400,
	0x0004,  0x0004,  0x0200,  0x0200,  0x0002,  0x0002,  0x0800,  0x0000,
	         // RF40: 2337 (....bbb*)
	0x0008,  0x0000,  0x0200,  0x0200,  0x0002,  0x0002,  0x0400,  0x0400,
	0x0004,  0x0004,  0x0200,  0x0200,  0x0002,  0x0002,  0x0600,  0x0000,
	         // RF30: 2353 (.....bb*)
	0x0006,  0x0000,  0x0200,  0x0200,  0x0002,  0x0002,  0x0400,  0x0000,
	0x0004,  0,       0x0200,  0,       0x0002,  0,       0x0000,  0,

	// RF72: 2368 (.bbbb*bb)         // RF62: 2372 (..bbb*bb)
	0x0000, 0x0002, 0x0200, 0x0000,  0x0000, 0x0002, 0x0200, 0x0000,
	0x0200, 0x0202, 0x0400, 0x0200,  0x0200, 0x0202, 0x0400, 0x0200,
	0x0002, 0x0004, 0x0202, 0x0002,  0x0002, 0x0004, 0x0202, 0x0002,
	0x0400, 0x0402, 0x0600, 0x0400,  0x0400, 0x0402, 0x0600, 0x0400,
	0x0004, 0x0006, 0x0204, 0x0004,  0x0004, 0x0006, 0x0204, 0x0004,
	0x0200, 0x0202, 0x0400, 0x0200,  0x0200, 0x0202, 0x0400, 0x0200,
	0x0002, 0x0004, 0x0202, 0x0002,  0x0002, 0x0004, 0x0202, 0x0002,
	0x0600, 0x0602, 0x0800, 0x0600,  0x0000, 0x0002, 0x0200, 0x0000,
	                                 // RF52: 2436 (...bb*bb)
	0x0006, 0x0008, 0x0206, 0x0006,  0x0000, 0x0002, 0x0200, 0x0000,
	0x0200, 0x0202, 0x0400, 0x0200,  0x0200, 0x0202, 0x0400, 0x0200,
	0x0002, 0x0004, 0x0202, 0x0002,  0x0002, 0x0004, 0x0202, 0x0002,
	0x0400, 0x0402, 0x0600, 0x0400,  0x0000, 0x0002, 0x0200, 0x0000,
	                                 // RF42 (....0*bb)
	0x0004, 0x0006, 0x0204, 0x0004,  0x0000, 0x0002, 0x0200, 0x0000,
	0x0200, 0x0202, 0x0400, 0x0200,  0x0000, 0x0002, 0x0200, 0x0000,
	                                 // RF32 (.....*bb)
	0x0002, 0x0004, 0x0202, 0x0002,  0x0000, 0x0002, 0x0200, 0x0000,
	0x0000, 0x0002, 0x0200, 0x0000,  0, 0, 0, 0,

	// LF72: 2496 (bbbb*bb.)
	         // LF61 (bbbb*0..)
	                           // LF50 (bbbb*...)
	0x0000,  0x0000,  0x0002,  0x0000,  0x0200,  0x0000,  0x0000,  0,
	    // RF73: 2504 (.bbb*bbb)
	    0x0000,  0x0004,  0x0002,  0x0002,  0x0200,  0x0200,  0x0400,  0x0000,
	0x0200,  0x0200,  0x0202,  0x0200,  0x0400,  0x0200,  0x0200,  0,
	    0x0200,  0x0204,  0x0202,  0x0202,  0x0400,  0x0400,  0x0600,  0x0200,
	0x0002,  0x0002,  0x0004,  0x0002,  0x0202,  0x0002,  0x0002,  0,
	    0x0002,  0x0006,  0x0004,  0x0004,  0x0202,  0x0202,  0x0402,  0x0002,
	0x0400,  0x0400,  0x0402,  0x0400,  0x0600,  0x0400,  0x0400,  0,
	    0x0400,  0x0404,  0x0402,  0x0402,  0x0600,  0x0600,  0x0800,  0x0400,
	0x0004,  0x0004,  0x0006,  0x0004,  0x0204,  0x0004,  0x0004,  0,
	    0x0004,  0x0008,  0x0006,  0x0006,  0x0204,  0x0204,  0x0404,  0x0004,
	0x0200,  0x0200,  0x0202,  0x0200,  0x0400,  0x0200,  0x0200,  0,
	    0x0200,  0x0204,  0x0202,  0x0202,  0x0400,  0x0400,  0x0600,  0x0200,
	0x0002,  0x0002,  0x0004,  0x0002,  0x0202,  0x0002,  0x0002,  0,
	    0x0002,  0x0006,  0x0004,  0x0004,  0x0202,  0x0202,  0x0402,  0x0002,
	0x0600,  0x0600,  0x0602,  0x0600,  0x0800,  0x0600,  0x0600,  0,
	    0x0000,  0x0004,  0x0002,  0x0002,  0x0200,  0x0200,  0x0400,  0x0000,
	0x0006,  0x0006,  0x0008,  0x0006,  0x0206,  0x0006,  0x0006,  0,
	    // RF63: 2632 (..bb*bbb)
	    0x0000,  0x0004,  0x0002,  0x0002,  0x0200,  0x0200,  0x0400,  0x0000,
	0x0200,  0x0200,  0x0202,  0x0200,  0x0400,  0x0200,  0x0200,  0,
	    0x0200,  0x0204,  0x0202,  0x0202,  0x0400,  0x0400,  0x0600,  0x0200,
	0x0002,  0x0002,  0x0004,  0x0002,  0x0202,  0x0002,  0x0002,  0,
	    0x0002,  0x0006,  0x0004,  0x0004,  0x0202,  0x0202,  0x0402,  0x0002,
	0x0400,  0x0400,  0x0402,  0x0400,  0x0600,  0x0400,  0x0400,  0,
	    0x0000,  0x0004,  0x0002,  0x0002,  0x0200,  0x0200,  0x0400,  0x0000,
	0x0004,  0x0004,  0x0006,  0x0004,  0x0204,  0x0004,  0x0004,  0,
	    // RF53 (...0*bbb)
	    0x0000,  0x0004,  0x0002,  0x0002,  0x0200,  0x0200,  0x0400,  0x0000,
	0x0200,  0x0200,  0x0202,  0x0200,  0x0400,  0x0200,  0x0200,  0,
	    0x0000,  0x0004,  0x0002,  0x0002,  0x0200,  0x0200,  0x0400,  0x0000,
	0x0002,  0x0002,  0x0004,  0x0002,  0x0202,  0x0002,  0x0002,  0,
	    // RF43 (....*bbb)
	    0x0000,  0x0004,  0x0002,  0x0002,  0x0200,  0x0200,  0x0400,  0x0000,
	0x0000,  0x0000,  0x0002,  0x0000,  0x0200,  0x0000,  0x0000,  0,

	// LF73: 2744 (bbb*bbb.)
	         // LF62: 2745 (bbb*bb..)
	                           // LF51 (bbb*0...)                  // LF40 (bbb*....)
	0x0000,  0x0000,  0x0004,  0x0000,  0x0002,  0x0002,  0x0002,  0x0000,
	0x0200,  0x0200,  0x0200,  0x0000,  0x0400,  0x0000,  0x0000,  0,
	    // RF74: 2760 (.bb*bbbb)
	    0x0000,  0x0006,  0x0004,  0x0004,  0x0002,  0x0002,  0x0002,  0x0002,
	    0x0200,  0x0200,  0x0200,  0x0200,  0x0400,  0x0400,  0x0600,  0x0000,
	0x0200,  0x0200,  0x0204,  0x0200,  0x0202,  0x0202,  0x0202,  0x0200,
	0x0400,  0x0400,  0x0400,  0x0200,  0x0600,  0x0200,  0x0200,  0,
	    0x0200,  0x0206,  0x0204,  0x0204,  0x0202,  0x0202,  0x0202,  0x0202,
	    0x0400,  0x0400,  0x0400,  0x0400,  0x0600,  0x0600,  0x0800,  0x0200,
	0x0002,  0x0002,  0x0006,  0x0002,  0x0004,  0x0004,  0x0004,  0x0002,
	0x0202,  0x0202,  0x0202,  0x0002,  0x0402,  0x0002,  0x0002,  0,
	    0x0002,  0x0008,  0x0006,  0x0006,  0x0004,  0x0004,  0x0004,  0x0004,
	    0x0202,  0x0202,  0x0202,  0x0202,  0x0402,  0x0402,  0x0602,  0x0002,
	0x0400,  0x0400,  0x0404,  0x0400,  0x0402,  0x0402,  0x0402,  0x0400,
	0x0600,  0x0600,  0x0600,  0x0400,  0x0800,  0x0400,  0x0400,  0,
	    0x0000,  0x0006,  0x0004,  0x0004,  0x0002,  0x0002,  0x0002,  0x0002,
	    0x0200,  0x0200,  0x0200,  0x0200,  0x0400,  0x0400,  0x0600,  0x0000,
	0x0004,  0x0004,  0x0008,  0x0004,  0x0006,  0x0006,  0x0006,  0x0004,
	0x0204,  0x0204,  0x0204,  0x0004,  0x0404,  0x0004,  0x0004,  0,
	    // RF64 (...0*bbbb)
	    0x0000,  0x0006,  0x0004,  0x0004,  0x0002,  0x0002,  0x0002,  0x0002,
	    0x0200,  0x0200,  0x0200,  0x0200,  0x0400,  0x0400,  0x0600,  0x0000,
	0x0200,  0x0200,  0x0204,  0x0200,  0x0202,  0x0202,  0x0202,  0x0200,
	0x0400,  0x0400,  0x0400,  0x0200,  0x0600,  0x0200,  0x0200,  0,
	    0x0000,  0x0006,  0x0004,  0x0004,  0x0002,  0x0002,  0x0002,  0x0002,
	    0x0200,  0x0200,  0x0200,  0x0200,  0x0400,  0x0400,  0x0600,  0x0000,
	0x0002,  0x0002,  0x0006,  0x0002,  0x0004,  0x0004,  0x0004,  0x0002,
	0x0202,  0x0202,  0x0202,  0x0002,  0x0402,  0x0002,  0x0002,  0,
	    // RF54 (....*bbbb)
	    0x0000,  0x0006,  0x0004,  0x0004,  0x0002,  0x0002,  0x0002,  0x0002,
	    0x0200,  0x0200,  0x0200,  0x0200,  0x0400,  0x0400,  0x0600,  0x0000,
	0x0000,  0x0000,  0x0004,  0x0000,  0x0002,  0x0002,  0x0002,  0x0000,
	0x0200,  0x0200,  0x0200,  0x0000,  0x0400,  0x0000,  0x0000,  0,

	// LF75: 2984 (0*bbbbb.)
	         // LF64: 2985 (0*bbbb..)                              // LF42: 2991 (0*bb....)
	                           // LF53:2987 (0*bbb...)             // LF31 (0*0.....)
	0x0000,  0x0000,  0x0008,  0x0000,  0x0006,  0x0006,  0x0006,  0x0000,
	0x0004,  0x0004,  0x0004,  0x0004,  0x0004,  0x0004,  0x0004,  0x0000,
	0x0002,  0x0002,  0x0002,  0x0002,  0x0002,  0x0002,  0x0002,  0x0002,
	0x0002,  0x0002,  0x0002,  0x0002,  0x0002,  0x0002,  0x0002,  0,
	0x0200,  0x0200,  0x0200,  0x0200,  0x0200,  0x0200,  0x0200,  0x0200,
	0x0200,  0x0200,  0x0200,  0x0200,  0x0200,  0x0200,  0x0200,  0x0000,
	0x0400,  0x0400,  0x0400,  0x0400,  0x0400,  0x0400,  0x0400,  0x0000,
	0x0600,  0x0600,  0x0600,  0x0000,  0x0800,  0x0000,  0x0000,  0,

	// LF76: 3048 (*bbbbbb.)
	         // LF65: 3049 (*bbbbb..)                              // LF43: 3055 (*bbb....)
	                           // LF54: 3051 (*bbbb...)            // LF32: 3063 (*bb.....)
	0x0000,  0x0000,  0x000a,  0x0000,  0x0008,  0x0008,  0x0008,  0x0000,
	0x0006,  0x0006,  0x0006,  0x0006,  0x0006,  0x0006,  0x0006,  0x0000,
	0x0004,  0x0004,  0x0004,  0x0004,  0x0004,  0x0004,  0x0004,  0x0004,
	0x0004,  0x0004,  0x0004,  0x0004,  0x0004,  0x0004,  0x0004,  0,
	0x0002,  0x0002,  0x0002,  0x0002,  0x0002,  0x0002,  0x0002,  0x0002,
	0x0002,  0x0002,  0x0002,  0x0002,  0x0002,  0x0002,  0x0002,  0x0002,
	0x0002,  0x0002,  0x0002,  0x0002,  0x0002,  0x0002,  0x0002,  0x0002,
	0x0002,  0x0002,  0x0002,  0x0002,  0x0002,  0x0002,  0x0002,  0,
	0x0200,  0x0200,  0x0200,  0x0200,  0x0200,  0x0200,  0x0200,  0x0200,
	0x0200,  0x0200,  0x0200,  0x0200,  0x0200,  0x0200,  0x0200,  0x0200,
	0x0200,  0x0200,  0x0200,  0x0200,  0x0200,  0x0200,  0x0200,  0x0200,
	0x0200,  0x0200,  0x0200,  0x0200,  0x0200,  0x0200,  0x0200,  0,
	0x0400,  0x0400,  0x0400,  0x0400,  0x0400,  0x0400,  0x0400,  0x0400,
	0x0400,  0x0400,  0x0400,  0x0400,  0x0400,  0x0400,  0x0400,  0x0000,
	0x0600,  0x0600,  0x0600,  0x0600,  0x0600,  0x0600,  0x0600,  0x0000,
	0x0800,  0x0800,  0x0800,  0x0000,  0x0a00,  0x0000,  0x0000,  0,
};	// 3176

enum {
	CF80 =    0, CF81 =  256, CF82 =  512, CF83 =  768, CF84 = 1024, CF85 = 1280, CF86 = 1536, CF87 = 1792,
	RF70 = 2048, RF71 = 2176, RF72 = 2368, RF73 = 2504, RF74 = 2760,
	RF60 = 2304, RF61 = 2178, RF62 = 2372, RF63 = 2632,
	RF50 = 2305, RF51 = 2242, RF52 = 2436,
	RF40 = 2337, RF41 = 2274,
	RF30 = 2353,
	LF72 = 2496, LF73 = 2744, LF74 = 2049, LF75 = 2984, LF76 = 3048,
	LF62 = 2745, LF63 = 2081, LF64 = 2985, LF65 = 3049,
	LF52 = 2083, LF53 = 2987, LF54 = 3051,
	LF42 = 2991, LF43 = 3055,
	LF32 = 3063
};

/* bit masks for diagonal lines */
static const V4DI mask_vdhd[64] = {
	{{ 0x0000000000000000, 0x00000000000000ff, 0x8040201008040201, 0x0101010101010101 }},
	{{ 0x0000000000000000, 0x00000000000000ff, 0x0080402010080400, 0x0202020202020202 }},
	{{ 0x0000000000010200, 0x00000000000000ff, 0x0000804020100800, 0x0404040404040404 }},
	{{ 0x0000000001020400, 0x00000000000000ff, 0x0000008040201000, 0x0808080808080808 }},
	{{ 0x0000000102040800, 0x00000000000000ff, 0x0000000080402000, 0x1010101010101010 }},
	{{ 0x0000010204081000, 0x00000000000000ff, 0x0000000000804000, 0x2020202020202020 }},
	{{ 0x0001020408102000, 0x00000000000000ff, 0x0000000000000000, 0x4040404040404040 }},
	{{ 0x0102040810204080, 0x00000000000000ff, 0x0000000000000000, 0x8080808080808080 }},
	{{ 0x0000000000000000, 0x000000000000ff00, 0x4020100804020000, 0x0101010101010101 }},
	{{ 0x0000000000000000, 0x000000000000ff00, 0x8040201008040201, 0x0202020202020202 }},	// RF31 -> 0
	{{ 0x0000000001020000, 0x000000000000ff00, 0x0080402010080000, 0x0404040404040404 }},	// RF42 -> CF82
	{{ 0x0000000102040000, 0x000000000000ff00, 0x0000804020100000, 0x0808080808080808 }},	// RF53 -> CF83
	{{ 0x0000010204080000, 0x000000000000ff00, 0x0000008040200000, 0x1010101010101010 }},	// RF64 -> CF84
	{{ 0x0001020408100000, 0x000000000000ff00, 0x0000000080400000, 0x2020202020202020 }},	// RF75 -> CF85
	{{ 0x0102040810204080, 0x000000000000ff00, 0x0000000000000000, 0x4040404040404040 }},	// RF31 -> 0
	{{ 0x0204081020400000, 0x000000000000ff00, 0x0000000000000000, 0x8080808080808080 }},
	{{ 0x0000000000000204, 0x0000000000ff0000, 0x2010080402000000, 0x0101010101010101 }},
	{{ 0x0000000000000408, 0x0000000000ff0000, 0x4020100804000000, 0x0202020202020202 }},	// RF42 -> CF82	// LF71 -> CF82
	{{ 0x0000000102000810, 0x0000000000ff0000, 0x8040201008040201, 0x0404040404040404 }},
	{{ 0x0000010204001020, 0x0000000000ff0000, 0x0080402010000402, 0x0808080808080808 }},
	{{ 0x0001020408002040, 0x0000000000ff0000, 0x0000804020000804, 0x1010101010101010 }},
	{{ 0x0102040810204080, 0x0000000000ff0000, 0x0000008040001008, 0x2020202020202020 }},
	{{ 0x0204081020000000, 0x0000000000ff0000, 0x0000000000002010, 0x4040404040404040 }},	// LF71 -> CF82	// RF42 -> CF82
	{{ 0x0408102040000000, 0x0000000000ff0000, 0x0000000000004020, 0x8080808080808080 }},
	{{ 0x0000000000020408, 0x00000000ff000000, 0x1008040200000000, 0x0101010101010101 }},
	{{ 0x0000000000040810, 0x00000000ff000000, 0x2010080400000000, 0x0202020202020202 }},	// RF53 -> CF83	// LF61 -> CF83
	{{ 0x0000010200081020, 0x00000000ff000000, 0x4020100800020100, 0x0404040404040404 }},
	{{ 0x0001020400102040, 0x00000000ff000000, 0x8040201008040201, 0x0808080808080808 }},
	{{ 0x0102040810204080, 0x00000000ff000000, 0x0080402000080402, 0x1010101010101010 }},
	{{ 0x0204081000408000, 0x00000000ff000000, 0x0000804000100804, 0x2020202020202020 }},
	{{ 0x0408102000000000, 0x00000000ff000000, 0x0000000000201008, 0x4040404040404040 }},	// LF61 -> CF83	// RF53 -> CF83
	{{ 0x0810204000000000, 0x00000000ff000000, 0x0000000000402010, 0x8080808080808080 }},
	{{ 0x0000000002040810, 0x000000ff00000000, 0x0804020000000000, 0x0101010101010101 }},
	{{ 0x0000000004081020, 0x000000ff00000000, 0x1008040000000000, 0x0202020202020202 }},	// RF64 -> CF84	// LF51 -> CF84
	{{ 0x0001020008102040, 0x000000ff00000000, 0x2010080002010000, 0x0404040404040404 }},
	{{ 0x0102040810204080, 0x000000ff00000000, 0x4020100004020100, 0x0808080808080808 }},
	{{ 0x0204080020408000, 0x000000ff00000000, 0x8040201008040201, 0x1010101010101010 }},
	{{ 0x0408100040800000, 0x000000ff00000000, 0x0080400010080402, 0x2020202020202020 }},
	{{ 0x0810200000000000, 0x000000ff00000000, 0x0000000020100804, 0x4040404040404040 }},	// LF51 -> CF84	// RF64 -> CF84
	{{ 0x1020400000000000, 0x000000ff00000000, 0x0000000040201008, 0x8080808080808080 }},
	{{ 0x0000000204081020, 0x0000ff0000000000, 0x0402000000000000, 0x0101010101010101 }},
	{{ 0x0000000408102040, 0x0000ff0000000000, 0x0804000000000000, 0x0202020202020202 }},	// RF75 -> CF85	// LF41 -> CF85
	{{ 0x0102040810204080, 0x0000ff0000000000, 0x1008000201000000, 0x0404040404040404 }},
	{{ 0x0204001020408000, 0x0000ff0000000000, 0x2010000402010000, 0x0808080808080808 }},
	{{ 0x0408002040800000, 0x0000ff0000000000, 0x4020000804020100, 0x1010101010101010 }},
	{{ 0x0810004080000000, 0x0000ff0000000000, 0x8040201008040201, 0x2020202020202020 }},
	{{ 0x1020000000000000, 0x0000ff0000000000, 0x0000002010080402, 0x4040404040404040 }},	// LF41 -> CF85	// RF75 -> CF85
	{{ 0x2040000000000000, 0x0000ff0000000000, 0x0000004020100804, 0x8080808080808080 }},
	{{ 0x0000020408102040, 0x00ff000000000000, 0x0000000000000000, 0x0101010101010101 }},
	{{ 0x0102040810204080, 0x00ff000000000000, 0x0000000000000000, 0x0202020202020202 }},
	{{ 0x0000081020408000, 0x00ff000000000000, 0x0000020100000000, 0x0404040404040404 }},	// LF71 -> CF82
	{{ 0x0000102040800000, 0x00ff000000000000, 0x0000040201000000, 0x0808080808080808 }},	// LF61 -> CF83
	{{ 0x0000204080000000, 0x00ff000000000000, 0x0000080402010000, 0x1010101010101010 }},	// LF51 -> CF84
	{{ 0x0000408000000000, 0x00ff000000000000, 0x0000100804020100, 0x2020202020202020 }},	// LF41 -> CF85
	{{ 0x0000000000000000, 0x00ff000000000000, 0x8040201008040201, 0x4040404040404040 }},	// LF31->0
	{{ 0x0000000000000000, 0x00ff000000000000, 0x0000402010080402, 0x8080808080808080 }},
	{{ 0x0102040810204080, 0xff00000000000000, 0x0000000000000000, 0x0101010101010101 }},
	{{ 0x0004081020408000, 0xff00000000000000, 0x0000000000000000, 0x0202020202020202 }},
	{{ 0x0008102040800000, 0xff00000000000000, 0x0002010000000000, 0x0404040404040404 }},
	{{ 0x0010204080000000, 0xff00000000000000, 0x0004020100000000, 0x0808080808080808 }},
	{{ 0x0020408000000000, 0xff00000000000000, 0x0008040201000000, 0x1010101010101010 }},
	{{ 0x0040800000000000, 0xff00000000000000, 0x0010080402010000, 0x2020202020202020 }},
	{{ 0x0000000000000000, 0xff00000000000000, 0x0020100804020100, 0x4040404040404040 }},
	{{ 0x0000000000000000, 0xff00000000000000, 0x8040201008040201, 0x8080808080808080 }}
};

#if defined(__AVX512VL__) || defined(__AVX10_1__)
	#define	TEST_EPI8_MASK32(X,Y)	_cvtmask32_u32(_mm256_test_epi8_mask((X), (Y)))
	#define	TEST_EPI8_MASK16(X,Y)	_cvtmask16_u32(_mm_test_epi8_mask((X), (Y)))
#else	// AVX2
	#define	TEST_EPI8_MASK32(X,Y)	_mm256_movemask_epi8(_mm256_sub_epi8(_mm256_setzero_si256(), _mm256_and_si256((X),(Y))))
	#define	TEST_EPI8_MASK16(X,Y)	_mm_movemask_epi8(_mm_sub_epi8(_mm_setzero_si128(), _mm_and_si128((X),(Y))))
#endif

/**
 * Count last flipped discs when playing on the last empty.
 *
 * @param pos the last empty square.
 * @param P player's disc pattern.
 * @return flipped disc count.
 */
int last_flip(int pos, unsigned long long P)
{
	uint_fast8_t n_flips;
	unsigned int t;
	const uint16_t *COUNT_FLIP_X = COUNT_FLIP + (pos & 0x07) * 256;
	const uint16_t *COUNT_FLIP_Y = COUNT_FLIP + (pos & 0x38) * 32;

  #ifdef AVXLASTFLIP	// no gain
	n_flips  = (uint8_t) COUNT_FLIP_X[(P >> (pos & 0x38)) & 0xFF];
	t = TEST_EPI8_MASK32(_mm256_set1_epi64x(P), mask_vdhd[pos].v4);
	n_flips += (uint8_t) COUNT_FLIP_Y[t & 0xFF];
	t >>= 16;

  #else
	__m128i PP = _mm_set1_epi64x(P);
	__m128i II = _mm_sad_epu8(_mm_and_si128(PP, mask_vdhd[pos].v2[0]), _mm_setzero_si128());

	n_flips  = (uint8_t) COUNT_FLIP_X[_mm_cvtsi128_si32(II)];
	n_flips += (uint8_t) COUNT_FLIP_X[_mm_extract_epi16(II, 4)];
	t = TEST_EPI8_MASK16(PP, mask_vdhd[pos].v2[1]);
  #endif
	n_flips += (uint8_t) COUNT_FLIP_Y[t & 0xFF];
	n_flips += (uint8_t) COUNT_FLIP_Y[t >> 8];

	return n_flips;
}

/**
 * @brief Get the final score.
 *
 * Get the final score, when 1 empty square remain.
 * The original code has been adapted from Zebra by Gunnar Anderson.
 *
 * @param PO     Board to evaluate. (O ignored)
 * @param alpha  Alpha bound. (beta - 1)
 * @param pos    Last empty square to play.
 * @return       The final score, as a disc difference.
 */
#if defined(__AVX2__) && defined(LASTFLIP_HIGHCUT)
// AVX2 NWS lazy high cut-off version
// http://www.amy.hi-ho.ne.jp/okuhara/edaxopt.htm#lazycutoff
// lazy high cut-off idea was in Zebra by Gunnar Anderson (http://radagast.se/othello/zebra.html),
// but commented out because mobility check was no faster than counting flips.
// Now using AVX2, mobility check can be faster than counting flips.
int vectorcall board_score_sse_1(__m128i OP, const int alpha, const int pos)
{
	int_fast8_t n_flips;
	uint32_t t;
	unsigned long long P = _mm_cvtsi128_si64(OP);
	int score = 2 * bit_count(P) - 64 + 2;	// = (bit_count(P) + 1) - (SCORE_MAX - 1 - bit_count(P))
		// if player can move, final score > this score.
		// if player pass then opponent play, final score < score - 1 (cancel P) - 1 (last O).
		// if both pass, score - 1 (cancel P) - 1 (empty for O) <= final score <= score (empty for P).

	if (score > alpha) {	// if player can move, high cut-off will occur regardress of n_flips.
  #ifdef AVX512_PREFER512	// may trigger license base downclocking
		__m512i P8 = _mm512_broadcastq_epi64(OP);
		__m512i M = lrmask[pos].v8;
		__m512i mO = _mm512_andnot_epi64(P8, M);
		__mmask8 fO = _mm512_test_epi64_mask(mO, _mm512_broadcastq_epi64(_mm_cvtsi64_si128(NEIGHBOUR[pos])));	// MSVC fails to use BCST for _mm512_set1_epi64
		if (_ktestz_mask8_u8(_mm512_test_epi64_mask(P8, M), fO)) {	// pass (16%)
			// n_flips = last_flip(pos, ~P);
			t = _cvtmask32_u32(_mm256_cmpneq_epi8_mask(_mm512_castsi512_si256(mO), _mm512_extracti64x4_epi64(mO, 1)));	// eq only if l = r = 0

  #elif defined(__AVX512VL__) || defined(__AVX10_1__)	// 256bit AVX512 (2.61s on skylake, 2.37 on icelake, 2.16s on Zen4)
		__m256i P4 = _mm256_broadcastq_epi64(OP);
		__m256i M = lrmask[pos].v4[0];
		__m256i F = _mm256_maskz_andnot_epi64(_mm256_test_epi64_mask(P4, M), P4, M);	// clear if all O
		M = lrmask[pos].v4[1];
		// F = _mm256_mask_or_epi64(F, _mm256_test_epi64_mask(P4, M), F, _mm256_andnot_si256(P4, M));
		F = _mm256_mask_ternarylogic_epi64(F, _mm256_test_epi64_mask(P4, M), P4, M, 0xF2);
		if (_mm256_testz_si256(F, _mm256_set1_epi64x(NEIGHBOUR[pos]))) {	// pass (16%)
			// n_flips = last_flip(pos, ~P);
			// t = _cvtmask32_u32(_mm256_cmpneq_epi8_mask(_mm256_andnot_si256(P4, lM), _mm256_andnot_si256(P4, rM)));
			t = _cvtmask32_u32(_mm256_test_epi8_mask(F, F));	// all O = all P = 0 flip

  #else	// AVX2
		__m256i P4 = _mm256_broadcastq_epi64(OP);
		__m256i M = lrmask[pos].v4[0];
		__m256i rmO = _mm256_andnot_si256(P4, M);
		__m256i F = _mm256_andnot_si256(_mm256_cmpeq_epi64(rmO, M), rmO);	// clear if all O
		M = lrmask[pos].v4[1];
		__m256i lmO = _mm256_andnot_si256(P4, M);
		F = _mm256_or_si256(F, _mm256_andnot_si256(_mm256_cmpeq_epi64(lmO, M), lmO));
		if (_mm256_testz_si256(F, _mm256_set1_epi64x(NEIGHBOUR[pos]))) {	// pass (16%)
			// n_flips = last_flip(pos, ~P);
			t = ~_mm256_movemask_epi8(_mm256_cmpeq_epi8(lmO, rmO));	// eq only if l = r = 0
  #endif
			const uint16_t *COUNT_FLIP_Y = COUNT_FLIP + (pos & 0x38) * 32;

			n_flips  = (uint8_t) COUNT_FLIP[(pos & 0x07) * 256 + ((~P >> (pos & 0x38)) & 0xFF)];	// h
			n_flips += (uint8_t) COUNT_FLIP_Y[(t >> 8) & 0xFF];	// v
			n_flips += (uint8_t) COUNT_FLIP_Y[(t >> 16) & 0xFF];	// d
			n_flips += (uint8_t) COUNT_FLIP_Y[t >> 24];	// d
				// last square for O if O can move or score <= 0
			score -= n_flips + (int)((-n_flips | (score - 1)) < 0) * 2;
		} else	score += 2;	// min flip

	} else {	// if player cannot move, low cut-off will occur whether opponent can move.
		const uint16_t *COUNT_FLIP_Y = COUNT_FLIP + (pos & 0x38) * 32;

		// n_flips = last_flip(pos, P);
		t = TEST_EPI8_MASK32(_mm256_broadcastq_epi64(OP), mask_vdhd[pos].v4);
		n_flips  = (uint8_t) COUNT_FLIP_Y[t & 0xFF];	// d
		n_flips += (uint8_t) COUNT_FLIP[(pos & 0x07) * 256 + ((P >> (pos & 0x38)) & 0xFF)];	// h
		n_flips += (uint8_t) COUNT_FLIP_Y[(t >> 16) & 0xFF];	// d
		n_flips += (uint8_t) COUNT_FLIP_Y[t >> 24];	// v
		score += n_flips;

		// if n_flips == 0, score <= alpha so lazy low cut-off
	}

	return score;
}

#elif defined(LASTFLIP_LOWCUT)
// Old COUNT_LAST_FLIP_SSE (2.61s on skylake, 2.16s on Zen4)
int vectorcall board_score_sse_1(__m128i OP, const int alpha, const int pos)
{
	uint_fast8_t n_flips;
	int score2;
	unsigned int t, op_flip;
	const uint16_t *COUNT_FLIP_X = COUNT_FLIP + (pos & 0x07) * 256;
	const uint16_t *COUNT_FLIP_Y = COUNT_FLIP + (pos & 0x38) * 32;

	// n_flips = last_flip(pos, P);
  #ifdef AVXLASTFLIP	// no gain
	unsigned long long P = _mm_cvtsi128_si64(OP);
	int score = 2 * bit_count(P) - 64 + 2;	// = (bit_count(P) + 1) - (SCORE_MAX - 1 - bit_count(P))
	__m256i M = mask_vdhd[pos].v4;
	__m256i P4 = _mm256_broadcastq_epi64(OP);

	op_flip  = COUNT_FLIP_X[(P >> (pos & 0x38)) & 0xFF];
	t = TEST_EPI8_MASK32(P4, M);
	n_flips  = (uint8_t) COUNT_FLIP_Y[t & 0xFF];
	t >>= 16;

  #else
	int score = 2 * bit_count_si64(OP) - 64 + 2;	// = (bit_count(P) + 1) - (SCORE_MAX - 1 - bit_count(P))
	__m128i M0 = mask_vdhd[pos].v2[0];
	__m128i M1 = mask_vdhd[pos].v2[1];
	__m128i P2 = _mm_unpacklo_epi64(OP, OP);
	__m128i II = _mm_sad_epu8(_mm_and_si128(P2, M0), _mm_setzero_si128());

	n_flips  = (uint8_t) COUNT_FLIP_X[_mm_cvtsi128_si32(II)];
	op_flip  = COUNT_FLIP_X[_mm_extract_epi16(II, 4)];
	t = TEST_EPI8_MASK16(P2, M1);
  #endif
	n_flips += (uint8_t) COUNT_FLIP_Y[t & 0xFF];
	op_flip += COUNT_FLIP_Y[t >> 8];
	n_flips += (uint8_t) op_flip;
	score += n_flips;

	if (n_flips == 0) {
		score2 = score - 2;	// empty for player
		if (score <= 0)
			score = score2;

		if (score > alpha) {	// lazy cut-off
			// n_flips = last_flip(pos, ~P);
			n_flips  = op_flip >> 8;
  #ifdef AVXLASTFLIP
			t = _mm256_movemask_epi8(_mm256_sub_epi8(_mm256_setzero_si256(), _mm256_andnot_si256(P4, M)));
			n_flips += (uint8_t) COUNT_FLIP_Y[(t >> 16) & 0xFF];
  #else
			II = _mm_andnot_si128(P2, _mm_unpacklo_epi64(M0, M1));
			t = _mm_movemask_epi8(_mm_sub_epi8(_mm_setzero_si128(), II));
			n_flips += (uint8_t) COUNT_FLIP_Y[t >> 8];
  #endif
			n_flips += (uint8_t) COUNT_FLIP_Y[t & 0xFF];

			if (n_flips != 0)
				score = score2 - n_flips;
		}
	}

	return score;
}

#else

  #ifdef AVXLASTFLIP
static const uint32_t cf_ofs_d[64] = {
	(CF80<<16)|   0, (RF70<<16)|   0, (RF60<<16)|RF30, (RF50<<16)|RF40, (RF40<<16)|RF50, (RF30<<16)|RF60, (   0<<16)|RF70, (   0<<16)|CF80,
	(CF81<<16)|   0, (CF81<<16)|   0, (RF71<<16)|RF41, (RF61<<16)|RF51, (RF51<<16)|RF61, (RF41<<16)|RF71, (   0<<16)|CF81, (   0<<16)|CF81,
	(CF82<<16)|CF82, (CF82<<16)|CF82, (CF82<<16)|RF52, (RF72<<16)|RF62, (RF62<<16)|RF72, (RF52<<16)|CF82, (CF82<<16)|CF82, (CF82<<16)|CF82,
	(CF83<<16)|CF83, (CF83<<16)|CF83, (LF72<<16)|RF63, (CF83<<16)|RF73, (RF73<<16)|CF83, (RF63<<16)|LF72, (CF83<<16)|CF83, (CF83<<16)|CF83,
	(CF84<<16)|CF84, (CF84<<16)|CF84, (LF62<<16)|RF74, (LF73<<16)|CF84, (CF84<<16)|LF73, (RF74<<16)|LF62, (CF84<<16)|CF84, (CF84<<16)|CF84,
	(CF85<<16)|CF85, (CF85<<16)|CF85, (LF52<<16)|CF85, (LF63<<16)|LF74, (LF74<<16)|LF63, (CF85<<16)|LF52, (CF85<<16)|CF85, (CF85<<16)|CF85,
	(   0<<16)|CF86, (   0<<16)|CF86, (LF42<<16)|LF75, (LF53<<16)|LF64, (LF64<<16)|LF53, (LF75<<16)|LF42, (CF86<<16)|   0, (CF86<<16)|   0,
	(   0<<16)|CF87, (   0<<16)|LF76, (LF32<<16)|LF65, (LF43<<16)|LF54, (LF54<<16)|LF43, (LF65<<16)|LF32, (LF76<<16)|   0, (CF87<<16)|   0
};

  #else
static const V4SI cf_ofs[64] = {
	{{    0, CF80, CF80, CF80 }}, {{    0, RF70, CF81, CF80 }}, {{ CF82, RF60, CF82, CF80 }}, {{ CF83, RF50, CF83, CF80 }},
	{{ CF84, RF40, CF84, CF80 }}, {{ CF85, RF30, CF85, CF80 }}, {{ CF86,    0, CF86, CF80 }}, {{ CF87,    0, CF87, CF80 }},
	{{    0, CF81, CF80, CF81 }}, {{    0, CF81, CF81, CF81 }}, {{ CF82, RF71, CF82, CF81 }}, {{ CF83, RF61, CF83, CF81 }},
	{{ CF84, RF51, CF84, CF81 }}, {{ CF85, RF41, CF85, CF81 }}, {{ CF86,    0, CF86, CF81 }}, {{ LF76,    0, CF87, CF81 }},
	{{ RF30, CF82, CF80, CF82 }}, {{ RF41, CF82, CF81, CF82 }}, {{ RF52, CF82, CF82, CF82 }}, {{ RF63, RF72, CF83, CF82 }},
	{{ RF74, RF62, CF84, CF82 }}, {{ CF85, RF52, CF85, CF82 }}, {{ LF75, CF82, CF86, CF82 }}, {{ LF65, CF82, CF87, CF82 }},
	{{ RF40, CF83, CF80, CF83 }}, {{ RF51, CF83, CF81, CF83 }}, {{ RF62, LF72, CF82, CF83 }}, {{ RF73, CF83, CF83, CF83 }},
	{{ CF84, RF73, CF84, CF83 }}, {{ LF74, RF63, CF85, CF83 }}, {{ LF64, CF83, CF86, CF83 }}, {{ LF54, CF83, CF87, CF83 }},
	{{ RF50, CF84, CF80, CF84 }}, {{ RF61, CF84, CF81, CF84 }}, {{ RF72, LF62, CF82, CF84 }}, {{ CF83, LF73, CF83, CF84 }},
	{{ LF73, CF84, CF84, CF84 }}, {{ LF63, RF74, CF85, CF84 }}, {{ LF53, CF84, CF86, CF84 }}, {{ LF43, CF84, CF87, CF84 }},
	{{ RF60, CF85, CF80, CF85 }}, {{ RF71, CF85, CF81, CF85 }}, {{ CF82, LF52, CF82, CF85 }}, {{ LF72, LF63, CF83, CF85 }},
	{{ LF62, LF74, CF84, CF85 }}, {{ LF52, CF85, CF85, CF85 }}, {{ LF42, CF85, CF86, CF85 }}, {{ LF32, CF85, CF87, CF85 }},
	{{ RF70,    0, CF80, CF86 }}, {{ CF81,    0, CF81, CF86 }}, {{ CF82, LF42, CF82, CF86 }}, {{ CF83, LF53, CF83, CF86 }},
	{{ CF84, LF64, CF84, CF86 }}, {{ CF85, LF75, CF85, CF86 }}, {{    0, CF86, CF86, CF86 }}, {{    0, CF86, CF87, CF86 }},
	{{ CF80,    0, CF80, CF87 }}, {{ CF81,    0, CF81, CF87 }}, {{ CF82, LF32, CF82, CF87 }}, {{ CF83, LF43, CF83, CF87 }},
	{{ CF84, LF54, CF84, CF87 }}, {{ CF85, LF65, CF85, CF87 }}, {{    0, LF76, CF86, CF87 }}, {{    0, CF87, CF87, CF87 }}
};
  #endif

// COUNT_LAST_FLIP_SSE - reasonably fast on all platforms
int vectorcall board_score_sse_1(__m128i OP, const int alpha, const int pos)
{
	uint_fast16_t op_flip;
	int p_flips, o_flips;
	unsigned int t;
  #ifdef AVXLASTFLIP	// no gain
	unsigned long long P = _mm_cvtsi128_si64(OP);
	int score = 2 * bit_count(P) - 64 + 2;	// = (bit_count(P) + 1) - (SCORE_MAX - 1 - bit_count(P))

	op_flip  = COUNT_FLIP[(pos & 0x07) * 256 + ((P >> (pos & 0x38)) & 0xFF)];	// h
	t = TEST_EPI8_MASK32(_mm256_broadcastq_epi64(OP), mask_vdhd[pos].v4);
	op_flip += COUNT_FLIP[(pos & 0x38) * 32 + (t >> 24)];	// v
	t = cf_ofs_d[pos] + (t & 0x00FF00FF);	// 0d0d
	op_flip += COUNT_FLIP[t & 0xFFFF];
	op_flip += COUNT_FLIP[t >> 16];

  #else
	int score = 2 * bit_count_si64(OP) - 64 + 2;	// = (bit_count(P) + 1) - (SCORE_MAX - 1 - bit_count(P))
	__m128i P2 = _mm_unpacklo_epi64(OP, OP);
	__m128i II = _mm_sad_epu8(_mm_and_si128(P2, mask_vdhd[pos].v2[0]), _mm_setzero_si128());	// hd

	II = _mm_add_epi32(II, cf_ofs[pos].v4);
	op_flip  = COUNT_FLIP[_mm_cvtsi128_si32(II)];
	op_flip += COUNT_FLIP[_mm_extract_epi16(II, 4)];
	t = TEST_EPI8_MASK16(P2, mask_vdhd[pos].v2[1]);	// vd
	op_flip += COUNT_FLIP[cf_ofs[pos].ui[1] + (t & 0xFF)];
	op_flip += COUNT_FLIP[cf_ofs[pos].ui[3] + (t >> 8)];
	// op_flip += COUNT_FLIP[((pos & 0x38) << 5) + (t >> 8)];
  #endif

	p_flips = op_flip & 0xFF;
	if (p_flips)
		return score + p_flips;

	o_flips = -(op_flip >> 8);
	(void) alpha;	// no lazy cut-off
	return score + o_flips - (int)((o_flips | (score - 1)) < 0) * 2;	// last square for O if O can move or score <= 0
}
#endif

int board_score_1(unsigned long long player, int alpha, int x)
{
	return board_score_sse_1(_mm_cvtsi64_si128(player), alpha, x);
}
